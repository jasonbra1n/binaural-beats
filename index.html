<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Sleep Binaural Beats Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
            max-width: 600px;
            margin: 2rem auto;
            padding: 1rem;
        }

        .container {
            background-color: #2a2a2a;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        h1 {
            color: #4CAF50;
            text-align: center;
        }

        .controls {
            margin: 2rem 0;
        }

        label {
            display: block;
            margin: 1rem 0;
        }

        select, input[type="range"], button {
            width: 100%;
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-radius: 5px;
            border: 1px solid #4CAF50;
            background-color: #333;
            color: white;
        }

        button {
            background-color: #4CAF50;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        #status {
            text-align: center;
            margin-top: 1rem;
            padding: 1rem;
            background-color: #333;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Deep Sleep Binaural Beats Generator</h1>
        <div class="controls">
            <label>
                Session Type:
                <select id="sessionType">
                    <option value="deepSleep">Deep Sleep Cycle</option>
                    <option value="rem">REM Recovery</option>
                    <option value="healing">Healing Frequency</option>
                </select>
            </label>

            <label>
                Duration (minutes):
                <input type="range" id="duration" min="15" max="120" value="45">
                <span id="durationValue">45</span> mins
            </label>

            <button id="controlButton">Start Session</button>
        </div>
        <div id="status">Ready</div>
    </div>

    <script>
        let audioContext;
        let leftOscillator, rightOscillator;
        let isPlaying = false;
        let startTime;
        let sessionTimeout;

        const frequencies = {
            deepSleep: { start: 100, end: 60 },
            rem: { start: 90, end: 70 },
            healing: { start: 528, end: 528 }
        };

        document.getElementById('duration').addEventListener('input', function(e) {
            document.getElementById('durationValue').textContent = e.target.value;
        });

        document.getElementById('controlButton').addEventListener('click', toggleSession);

        function toggleSession() {
            if (isPlaying) {
                stopSession();
            } else {
                startSession();
            }
        }

        function startSession() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            const sessionType = document.getElementById('sessionType').value;
            const duration = document.getElementById('duration').value * 60;
            const { start, end } = frequencies[sessionType];

            // Create oscillators
            leftOscillator = audioContext.createOscillator();
            rightOscillator = audioContext.createOscillator();

            // Create splitter for stereo output
            const splitter = audioContext.createChannelSplitter(2);
            
            // Connect nodes
            leftOscillator.connect(splitter);
            rightOscillator.connect(splitter);
            splitter.connect(audioContext.destination, 0, 0); // Left channel
            splitter.connect(audioContext.destination, 1, 1); // Right channel

            // Set initial frequencies
            leftOscillator.frequency.value = start;
            rightOscillator.frequency.value = sessionType === 'healing' ? start : start - 0.1;

            // Configure oscillator types
            leftOscillator.type = 'sine';
            rightOscillator.type = 'sine';

            // Start oscillators
            leftOscillator.start();
            rightOscillator.start();

            // Schedule frequency changes
            if (sessionType !== 'healing') {
                const startFrequency = start;
                const endFrequency = end;
                const rampTime = duration - 1800; // Last 30 minutes for REM rise

                leftOscillator.frequency.linearRampToValueAtTime(
                    endFrequency, 
                    audioContext.currentTime + duration
                );

                rightOscillator.frequency.linearRampToValueAtTime(
                    endFrequency - 0.1, 
                    audioContext.currentTime + duration
                );

                if (sessionType === 'rem') {
                    // Schedule REM frequency rise for last 30 minutes
                    const remStartTime = duration - 1800;
                    leftOscillator.frequency.setValueAtTime(endFrequency, audioContext.currentTime + remStartTime);
                    leftOscillator.frequency.linearRampToValueAtTime(
                        startFrequency, 
                        audioContext.currentTime + duration
                    );

                    rightOscillator.frequency.setValueAtTime(endFrequency - 0.1, audioContext.currentTime + remStartTime);
                    rightOscillator.frequency.linearRampToValueAtTime(
                        startFrequency - 0.1, 
                        audioContext.currentTime + duration
                    );
                }
            }

            // Update UI
            isPlaying = true;
            startTime = Date.now();
            document.getElementById('controlButton').textContent = 'Stop Session';
            updateStatus(duration);
        }

        function stopSession() {
            if (leftOscillator) {
                leftOscillator.stop();
                rightOscillator.stop();
                leftOscillator = null;
                rightOscillator = null;
            }
            clearTimeout(sessionTimeout);
            isPlaying = false;
            document.getElementById('controlButton').textContent = 'Start Session';
            document.getElementById('status').textContent = 'Session Stopped';
        }

        function updateStatus(duration) {
            if (!isPlaying) return;

            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const remaining = duration - elapsed;

            if (remaining > 0) {
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                document.getElementById('status').textContent = 
                    `Session Active - Time Remaining: ${minutes}m ${seconds}s`;
                sessionTimeout = setTimeout(() => updateStatus(duration), 1000);
            } else {
                document.getElementById('status').textContent = 'Session Completed';
                stopSession();
            }
        }
    </script>
</body>
</html>
